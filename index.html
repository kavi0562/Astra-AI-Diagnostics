<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astra AI Diagnostics Platform</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* Set Inter as the default font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #2563eb;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #1d4ed8;
        }
        /* Style for the loading spinner */
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Styles for active/inactive tabs */
        .tab-btn-active {
            @apply bg-blue-600 text-white shadow-lg;
        }
        .tab-btn-inactive {
            @apply bg-white text-slate-600 hover:bg-slate-100;
        }
        
        /* --- Tooltip Styles --- */
        .tooltip-container {
            position: relative;
            display: inline-block;
        }
        
        .tooltip-icon {
            color: #94a3b8; /* slate-400 */
            cursor: pointer;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: #1e293b; /* slate-800 */
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Position above the icon */
            left: 50%;
            margin-left: -140px; /* Use half of the width to center */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem; /* 14px */
            line-height: 1.5;
            font-weight: 400;
        }

        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* --- Drop Zone Styles --- */
        .drop-zone {
            @apply mt-1 flex justify-center rounded-lg border-2 border-dashed border-slate-300 px-6 py-8 transition-colors;
        }
        .drop-zone-over {
            @apply border-blue-500 bg-blue-50;
        }
        .drop-zone-text {
            @apply text-center text-slate-500;
        }

        /* --- Precaution Banner Styles --- */
        .precaution-banner {
            @apply mt-6 rounded-lg border p-4;
        }
        .precaution-banner-high {
            @apply border-red-200 bg-red-50 text-red-900;
        }
        .precaution-banner-medium {
            @apply border-amber-200 bg-amber-50 text-amber-900;
        }
        .precaution-banner-low {
            @apply border-green-200 bg-green-50 text-green-900;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="#" class="flex items-center gap-2">
                    <i class="ph-bold ph-activity text-3xl text-blue-600"></i>
                    <span class="font-bold text-xl text-slate-900">Astra AI Diagnostics</span>
                </a>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#problem" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors">The Problem</a>
                    <a href="#features" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors">Features</a>
                    <a href="#demo" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors">CDS Demo</a>
                    <a href="#history" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors">Patient History</a>
                    <a href="#outcomes" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors">Outcomes</a>
                    <a href="#contact" class="ml-4 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-blue-700 transition-colors">
                        Request a Demo
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-slate-700 hover:text-blue-600">
                        <i class="ph ph-list text-3xl"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden px-4 pt-2 pb-4 space-y-2 bg-white border-b border-slate-200">
            <a href="#problem" class="block text-base font-medium text-slate-600 hover:bg-slate-100 p-2 rounded-lg">The Problem</a>
            <a href="#features" class="block text-base font-medium text-slate-600 hover:bg-slate-100 p-2 rounded-lg">Features</a>
            <a href="#demo" class="block text-base font-medium text-slate-600 hover:bg-slate-100 p-2 rounded-lg">CDS Demo</a>
            <a href="#history" class="block text-base font-medium text-slate-600 hover:bg-slate-100 p-2 rounded-lg">Patient History</a>
            <a href="#outcomes" class="block text-base font-medium text-slate-600 hover:bg-slate-100 p-2 rounded-lg">Outcomes</a>
            <a href="#contact" class="block text-base font-medium text-white bg-blue-600 hover:bg-blue-700 p-2 rounded-lg text-center">
                Request a Demo
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Hero Section -->
        <section class="text-center py-16 md:py-24">
            <span class="inline-block px-4 py-1.5 bg-blue-100 text-blue-700 font-semibold text-xs rounded-full uppercase tracking-wider">
                AI-Enabled Early Diagnosis
            </span>
            <h1 class="text-4xl md:text-6xl font-bold text-slate-900 mt-4 max-w-4xl mx-auto">
                Predict Disease, <span class="text-blue-600">Prolong Life.</span>
            </h1>
            <p class="text-lg md:text-xl text-slate-600 mt-6 max-w-3xl mx-auto">
                Our platform leverages multimodal AI to analyze patient data in real-time, enabling early detection of chronic diseases like cancer, diabetes, and heart ailments.
            </p>
            <div class="flex justify-center gap-4 mt-10">
                <a href="#demo" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg shadow-lg hover:bg-blue-700 transition-all transform hover:-translate-y-0.5">
                    Run CDS Demo
                </a>
                <a href="#features" class="px-6 py-3 bg-white text-slate-700 font-medium rounded-lg shadow-lg hover:bg-slate-100 ring-1 ring-slate-200 transition-all">
                    Learn More
                </a>
            </div>
        </section>

        <!-- The Problem -->
        <section id="problem" class="py-16">
            <div class="grid md:grid-cols-2 gap-12 items-center">
                <div>
                    <h2 class="text-3xl font-bold text-slate-900">The High Cost of Delayed Diagnosis</h2>
                    <p class="text-lg text-slate-600 mt-4">
                        Delayed diagnosis of chronic and life-threatening diseases leads to late-stage treatment, higher healthcare costs, and lower patient survival rates.
                    </p>
                    <p class="text-slate-600 mt-4">
                        Traditional methods often rely on invasive tests, limited access to specialist care, or delayed reporting. This critical gap between symptom onset and confirmed diagnosis is where our AI platform makes a life-saving difference.
                    </p>
                </div>
                <!-- Mockup Image -->
                <div class="bg-white p-6 rounded-2xl shadow-2xl shadow-blue-100 ring-1 ring-slate-100">
                    <div class="aspect-video bg-slate-200 rounded-lg flex items-center justify-center">
                        <img src="https://placehold.co/600x400/e2e8f0/64748b?text=Clinical+Dashboard+Mockup" alt="Clinical Dashboard Mockup" class="rounded-lg object-cover">
                    </div>
                    <p class="text-sm text-slate-500 mt-4 text-center">Astra AI Clinical Decision Support (CDS) Interface</p>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-16">
            <div class="text-center max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-slate-900">A Platform Built for Clinicians</h2>
                <p class="text-lg text-slate-600 mt-4">
                    We turn complex patient data into clear, actionable insights to support your clinical decisions.
                </p>
            </div>
            <div class="grid md:grid-cols-3 gap-8 mt-12">
                <!-- Feature 1: Accurate Prediction -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-chart-line-up text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Accurate Disease Prediction</h3>
                    <p class="text-slate-600 mt-2">Specialized models for Diabetes, Heart Disease, and Cancer to support early detection.</p>
                </div>
                
                <!-- Feature 2: Enhanced CDS Tool -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-brain text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Enhanced Clinical Decision Support</h3>
                    <p class="text-slate-600 mt-2">Improves diagnostic efficiency and consistency with clear, data-driven insights.</p>
                </div>

                <!-- Feature 3: Explainable AI (XAI) -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-sparkle text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Explainable AI (XAI)</h3>
                    <p class="text-slate-600 mt-2">Provides clear, transparent outputs (e.g., "Risk is high due to these 3 factors") to build clinical trust.</p>
                </div>

                <!-- Feature 4: Multimodal Data -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-camera text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Multimodal Data Integration</h3>
                    <p class="text-slate-600 mt-2">Integrates lab reports, patient history, medical images, and wearable data for a complete picture.</p>
                </div>

                <!-- Feature 5: Remote Screening -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-globe text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Remote Screening & Accessibility</h3>
                    <p class="text-slate-600 mt-2">Web-based platform enables remote diagnostics, improving access to care in all regions.</p>
                </div>

                <!-- Feature 6: Scalable Framework (EHR) -->
                <div class="bg-white p-6 rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 transition-all hover:shadow-xl">
                    <i class="ph-bold ph-plugs text-4xl text-blue-600 bg-blue-100 p-3 rounded-lg"></i>
                    <h3 class="text-xl font-semibold text-slate-900 mt-4">Scalable & Integratable</h3>
                    <p class="text-slate-600 mt-2">Scalable framework built to integrate with existing hospital management systems and EHRs.</p>
                </div>
            </div>
        </section>

        <!-- CDS Demo Section -->
        <section id="demo" class="py-16 bg-slate-100 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-slate-900">Clinical Decision Support (CDS) Demo</h2>
                <p class="text-lg text-slate-600 mt-4">
                    Select a model and enter patient data to see a simulated risk report.
                    <span class="block text-sm font-medium text-amber-700 mt-2">
                        <i class="ph ph-warning-circle"></i> This is a simulation. Not for medical use.
                    </span>
                </p>
            </div>

            <!-- Tab Buttons -->
            <div class="flex justify-center gap-2 md:gap-4 mt-8 max-w-lg mx-auto p-1 bg-slate-200 rounded-lg">
                <button id="tab-btn-diabetes" class="tab-btn flex-1 px-4 py-2 text-sm md:text-base font-medium rounded-md transition-all tab-btn-active">
                    Assess Diabetes
                </button>
                <button id="tab-btn-heart" class="tab-btn flex-1 px-4 py-2 text-sm md:text-base font-medium rounded-md transition-all tab-btn-inactive">
                    Assess Heart Disease
                </button>
                <button id="tab-btn-cancer" class="tab-btn flex-1 px-4 py-2 text-sm md:text-base font-medium rounded-md transition-all tab-btn-inactive">
                    Assess Cancer
                </button>
            </div>

            <div class="grid lg:grid-cols-5 gap-8 mt-12 max-w-7xl mx-auto">
                
                <!-- Form Inputs Container -->
                <div class="lg:col-span-2 bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-2xl font-semibold text-slate-900">Patient Vitals & History</h3>
                    <div id="form-error" class="text-sm text-red-600 font-medium mt-4 text-center"></div>

                    <!-- Diabetes Form -->
                    <form id="diabetes-form" class="mt-6 space-y-4">
                        <h4 class="text-lg font-medium text-blue-700">General Diabetes Risk</h4>
                        <div>
                            <label for="name-d" class="block text-sm font-medium text-slate-700">Patient Name</label>
                            <input type="text" id="name-d" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" placeholder="e.g., John Doe" required>
                        </div>
                        <div>
                            <label for="age-d" class="block text-sm font-medium text-slate-700">Age</label>
                            <input type="number" id="age-d" value="45" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="height-d" class="block text-sm font-medium text-slate-700">Height (cm)</label>
                                <input type="number" id="height-d" value="170" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                             <div>
                                <label for="weight-d" class="block text-sm font-medium text-slate-700">Weight (kg)</label>
                                <input type="number" id="weight-d" value="85" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                        </div>
                        <div>
                            <label for="glucose" class="block text-sm font-medium text-slate-700">Glucose (mg/dL)</label>
                            <input type="number" id="glucose" value="120" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                        </div>
                        <div>
                            <label for="bp-d" class="block text-sm font-medium text-slate-700">Systolic Blood Pressure</label>
                            <input type="number" id="bp-d" value="135" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                        </div>
                         <div class="flex items-center gap-2 pt-2">
                            <input id="history-d" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                            <label for="history-d" class="text-sm font-medium text-slate-700">Family History of Diabetes</label>
                        </div>
                        <button type="submit" class="mt-4 w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
                            Run Diabetes Analysis
                        </button>
                    </form>
                    
                    <!-- Heart Form -->
                    <form id="heart-form" class="mt-6 space-y-4 hidden">
                        <h4 class="text-lg font-medium text-blue-700">Clinical Heart Disease Risk</h4>
                        <div>
                            <label for="name-h" class="block text-sm font-medium text-slate-700">Patient Name</label>
                            <input type="text" id="name-h" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" placeholder="e.g., Jane Smith" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="age-h" class="block text-sm font-medium text-slate-700">Age</label>
                                <input type="number" id="age-h" value="55" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                             <div>
                                <label for="sex" class="block text-sm font-medium text-slate-700">Sex</label>
                                <select id="sex" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm">
                                    <option value="1">Male</option>
                                    <option value="0">Female</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="cp" class="block text-sm font-medium text-slate-700">
                                Chest Pain Type
                                <span class="tooltip-container">
                                    <i class="ph ph-info text-sm align-middle tooltip-icon"></i>
                                    <span class="tooltip-text">
                                        <b>Typical Angina:</b> Chest pain related to exertion.
                                        <br>
                                        <b>Atypical Angina:</b> Chest pain not fully typical.
                                        <br>
                                        <b>Non-anginal Pain:</b> Pain not related to the heart.
                                        <br>
                                        <b>Asymptomatic:</b> No chest pain.
                                    </span>
                                </span>
                            </label>
                            <select id="cp" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm">
                                <option value="0">Typical Angina</option>
                                <option value="1">Atypical Angina</option>
                                <option value="2">Non-anginal Pain</option>
                                <option value="3" selected>Asymptomatic</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="trestbps" class="block text-sm font-medium text-slate-700">Resting BP (SBP)</label>
                                <input type="number" id="trestbps" value="140" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                            <div>
                                <label for="chol" class="block text-sm font-medium text-slate-700">Cholesterol (mg/dL)</label>
                                <input type="number" id="chol" value="210" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="fbs" class="block text-sm font-medium text-slate-700">Fasting BS > 120</label>
                                <select id="fbs" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                            <div>
                                <label for="exang" class="block text-sm font-medium text-slate-700">
                                    Exercise Angina
                                    <span class="tooltip-container">
                                        <i class="ph ph-info text-sm align-middle tooltip-icon"></i>
                                        <span class="tooltip-text">
                                            Does the patient experience chest pain (angina) when they exercise?
                                        </span>
                                    </span>
                                </label>
                                <select id="exang" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm">
                                    <option value="0">No</option>
                                    <option value="1">Yes</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="thalach" class="block text-sm font-medium text-slate-700">Max Heart Rate Achieved</label>
                            <input type="number" id="thalach" value="150" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                        </div>
                        
                        <!-- Multimodal Upload Dropzone -->
                        <div class="pt-2">
                            <label class="block text-sm font-medium text-slate-700">Upload EKG (Wearable Data)</label>
                            <div id="ekg-drop-zone" class="drop-zone">
                                <div class="drop-zone-text">
                                    <i class="ph ph-cloud-arrow-up text-4xl text-slate-400"></i>
                                    <p class="mt-1 text-sm">Drag & drop EKG data file here</p>
                                    <p class="text-xs text-slate-400">(Simulated)</p>
                                </div>
                            </div>
                            <div id="ekg-file-name" class="mt-2 text-sm font-medium text-green-700"></div>
                        </div>
                        
                        <button type="submit" class="mt-4 w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
                            Run Heart Analysis
                        </button>
                    </form>

                    <!-- Cancer Form -->
                    <form id="cancer-form" class="mt-6 space-y-4 hidden">
                        <h4 class="text-lg font-medium text-blue-700">General Cancer Risk Factors</h4>
                        <div>
                            <label for="name-c" class="block text-sm font-medium text-slate-700">Patient Name</label>
                            <input type="text" id="name-c" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" placeholder="e.g., Maria Garcia" required>
                        </div>
                        <div>
                            <label for="age-c" class="block text-sm font-medium text-slate-700">Age</label>
                            <input type="number" id="age-c" value="62" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="height-c" class="block text-sm font-medium text-slate-700">Height (cm)</label>
                                <input type="number" id="height-c" value="165" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                             <div>
                                <label for="weight-c" class="block text-sm font-medium text-slate-700">Weight (kg)</label>
                                <input type="number" id="weight-c" value="90" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm" required>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 pt-2">
                            <input id="smoker-c" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                            <label for="smoker-c" class="text-sm font-medium text-slate-700">Current Smoker</label>
                        </div>
                        <div class="flex items-center gap-2 pt-2">
                            <input id="history-c" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                            <label for="history-c" class="text-sm font-medium text-slate-700">Family History of Cancer</label>
                        </div>
                        
                        <!-- Multimodal Upload Dropzone -->
                        <div class="pt-2">
                            <label class="block text-sm font-medium text-slate-700">Upload Imaging (CT/PET Scan)</label>
                            <div id="scan-drop-zone" class="drop-zone">
                                <div class="drop-zone-text">
                                    <i class="ph ph-cloud-arrow-up text-4xl text-slate-400"></i>
                                    <p class="mt-1 text-sm">Drag & drop scan file here</p>
                                    <p class="text-xs text-slate-400">(Simulated)</p>
                                </div>
                            </div>
                            <div id="scan-file-name" class="mt-2 text-sm font-medium text-green-700"></div>
                        </div>

                        <button type="submit" class="mt-4 w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
                            Run Cancer Analysis
                        </button>
                    </form>
                </div>

                <!-- Results Panel -->
                <div class="lg:col-span-3 bg-white p-8 rounded-2xl shadow-xl">
                    <h3 class="text-2xl font-semibold text-slate-900">Simulated AI Report</h3>
                    <div id="results-panel" class="mt-6">
                        <!-- Loading State -->
                        <div id="loader" class="hidden flex-col items-center justify-center h-96 text-slate-500">
                            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                            <p class="text-lg font-medium">Running analysis...</p>
                            <p class="text-sm">Simulating prediction from the selected model.</p>
                        </div>

                        <!-- Initial State -->
                        <div id="initial-state" class="flex flex-col items-center justify-center h-96 text-slate-400">
                            <i class="ph ph-file-text text-8xl"></i>
                            <p class="text-lg font-medium mt-4">Results will appear here</p>
                            <p class="text-sm">Select a model and enter patient data.</p>
                        </div>
                        
                        <!-- Results State -->
                        <div id="results-state" class="hidden">
                            <!-- Patient Info Header -->
                            <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                <h4 class="text-lg font-semibold text-slate-900" id="result-title">Diabetes Risk Report</h4>
                                <p class="text-sm text-slate-600" id="result-patient-name">Patient: John Doe</p>
                            </div>
                            
                            <!-- Risk Scores -->
                            <div class="space-y-6 mt-6">
                                <div id="risk-result-container">
                                    <div class="flex justify-between items-baseline">
                                        <h5 class="text-lg font-semibold text-slate-800">Risk Score</h5>
                                        <span id="risk-value" class="text-2xl font-bold text-amber-600">72% (High)</span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                                        <div id="risk-bar" class="bg-amber-500 h-2.5 rounded-full" style="width: 72%"></div>
                                    </div>
                                    <p id="risk-insight" class="text-sm text-slate-600 mt-2">Insight: Uncontrolled diabetes increases the risk of nerve damage, kidney failure, and vision loss.</p>
                                </div>
                            </div>

                            <!-- Precaution Section -->
                            <div id="precaution-container" class="precaution-banner precaution-banner-high">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="ph-bold ph-first-aid-kit text-xl"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h5 class="text-sm font-semibold">Recommended Precaution</h5>
                                        <p class="text-sm mt-1" id="precaution-text">Consult your doctor immediately. Focus on strict glucose monitoring, diet, and exercise.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- NEW: Next Steps Section -->
                            <div id="next-steps-container" class="mt-4 p-4 bg-slate-100 rounded-lg">
                                <h5 class="text-sm font-semibold text-slate-800">Recommended Next Steps</h5>
                                <ul id="next-steps-list" class="mt-2 list-disc list-inside text-sm text-slate-700 space-y-1">
                                    <li>Order HbA1c lab test.</li>
                                    <li>Refer to endocrinologist.</li>
                                </ul>
                            </div>

                            <!-- XAI Finding -->
                            <div class="mt-6">
                                <h5 class="text-lg font-semibold text-slate-900">Explainable AI (XAI) Finding</h5>
                                <div class="mt-2 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p class="text-sm text-blue-800" id="xai-finding">
                                        <strong>Primary Drivers:</strong> Diabetes risk is high because the patient's <strong>Glucose (130)</strong> is significantly above the average for their age group.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Patient History Section -->
        <section id="history" class="py-16">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-slate-900">Patient History Log</h2>
                <p class="text-lg text-slate-600 mt-4">
                    A list of all patients saved to this browser's local storage.
                </p>
                <div class="flex justify-between items-center mt-2">
                    <p class="text-sm font-medium text-slate-700">
                        Total Patients: <span id="patient-count" class="font-bold text-blue-600">0</span>
                    </p>
                    <button id="clear-history-btn" class="px-4 py-2 bg-red-100 text-red-700 text-sm font-medium rounded-lg hover:bg-red-200 transition-colors">
                        <i class="ph ph-trash"></i> Clear History
                    </button>
                </div>

                <!-- History Table -->
                <div class="mt-6 bg-white rounded-xl shadow-lg shadow-slate-100 ring-1 ring-slate-100 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-max text-left">
                            <thead class="border-b border-slate-200 bg-slate-50">
                                <tr>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Patient Name</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Age</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Assessment</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Risk Score</th>
                                    <th class="p-4 text-sm font-semibold text-slate-600">Key Inputs</th>
                                </tr>
                            </thead>
                            <tbody id="history-table-body">
                                <!-- Initial Row -->
                                <tr id="empty-row">
                                    <td colspan="5" class="p-8 text-center text-slate-500">
                                        No patient history found.
                                    </td>
                                </tr>
                                <!-- Rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Outcomes Section -->
        <section id="outcomes" class="py-16 bg-slate-100 -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto">
                <div class="text-center max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-slate-900">Delivering Measurable Impact</h2>
                    <p class="text-lg text-slate-600 mt-4">
                        By providing an accurate, early-stage risk assessment, our platform helps reduce diagnostic delays and enables faster medical intervention.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 mt-12 text-center">
                    <!-- Stat 1 -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-slate-200">
                        <span class="text-5xl font-bold text-blue-600">~91%</span>
                        <p class="text-lg font-medium text-slate-700 mt-3">Diabetes Model Accuracy</p>
                        <p class="text-slate-600 mt-1">Simulated model accuracy based on general population risk factors.</p>
                    </div>
                    <!-- Stat 2 -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-slate-200">
                        <span class="text-5xl font-bold text-blue-600">~98%</span>
                        <p class="text-lg font-medium text-slate-700 mt-3">Heart Disease Model Accuracy</p>
                        <p class="text-slate-600 mt-1">Simulated model accuracy based on the Cleveland Clinic heart disease dataset.</p>
                    </div>
                    <!-- Stat 3 -->
                    <div class="bg-white p-8 rounded-xl shadow-lg shadow-slate-200">
                        <span class="text-5xl font-bold text-blue-600">~97%</span>
                        <p class="text-lg font-medium text-slate-700 mt-3">Cancer Model Accuracy</p>
                        <p class="text-slate-600 mt-1">Simulated model accuracy based on general population risk factors.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section id="contact" class="py-24 text-center">
            <h2 class="text-3xl md:text-4xl font-bold text-slate-900 max-w-3xl mx-auto">
                Ready to Enhance Your Diagnostic Capabilities?
            </h2>
            <p class="text-lg text-slate-600 mt-6 max-w-2xl mx-auto">
                Schedule a personalized consultation with our team to see how the Astra AI platform can integrate with your workflow and improve patient outcomes.
            </p>
            <a href="#" class="mt-10 inline-block px-8 py-4 bg-blue-600 text-white text-lg font-medium rounded-lg shadow-lg hover:bg-blue-700 transition-all transform hover:-translate-y-0.5">
                Schedule a Consultation
            </a>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center gap-2">
                    <i class="ph-bold ph-activity text-3xl text-blue-400"></i>
                    <span class="font-bold text-xl text-white">Astra AI Diagnostics</span>
                </div>
                <div class="flex gap-6 mt-6 md:mt-0">
                    <a href="#features" class="text-sm hover:text-white transition-colors">Features</a>
                    <a href="#demo" class="text-sm hover:text-white transition-colors">Demo</a>
                    <a href="#history" class="text-sm hover:text-white transition-colors">History</a>
                    <a href="#outcomes" class="text-sm hover:text-white transition-colors">Outcomes</a>
                    <a href="#contact" class="text-sm hover:text-white transition-colors">Contact</a>
                </div>
            </div>
            <div class="mt-8 border-t border-slate-700 pt-8 text-center md:text-left">
                <p class="text-sm">&copy; 2025 Astra AI Diagnostics. All rights reserved. This is a fictional platform for demonstration purposes.</p>
            </div>
        </div>
    </footer>


    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Global Object to hold "trained" simulation models ---
            const trainedModels = {};
            // --- Global list for patient history ---
            let patientHistory = [];

            // --- NEW: Precautions Database ---
            const PRECAUTIONS = {
                diabetes: {
                    high: "Consult your doctor immediately. Focus on strict glucose monitoring, diet, and exercise.",
                    medium: "Proactive lifestyle changes are key. Monitor your diet (reduce sugar/carbs) and increase physical activity.",
                    low: "Maintain a healthy lifestyle. Continue regular check-ups and be mindful of your diet."
                },
                heart: {
                    high: "Immediate medical consultation is advised. Your doctor may suggest EKG, stress tests, and medication.",
                    medium: "Focus on heart-healthy habits. Reduce sodium and saturated fats, manage stress, and aim for 150 mins of exercise/week.",
                    low: "Excellent. Continue a heart-healthy diet, stay active, and manage stress."
                },
                cancer: {
                    high: "Speak to your doctor about a screening plan (e.g., mammogram, colonoscopy, lung CT scan) immediately.",
                    medium: "Discuss your risk factors (smoking, family history) with your doctor. Adopt a healthy lifestyle and schedule regular check-ups.",
                    low: "Continue a healthy lifestyle, avoid smoking, and follow standard screening guidelines for your age."
                }
            };

            // --- NEW: Next Steps Database ---
            const NEXT_STEPS = {
                diabetes: {
                    high: ["Order HbA1c lab test.", "Refer to endocrinologist.", "Provide nutritional counseling."],
                    medium: ["Order fasting glucose test.", "Recommend lifestyle changes.", "Schedule 6-month follow-up."],
                    low: ["Continue annual wellness checks.", "Reinforce healthy diet and exercise."]
                },
                heart: {
                    high: ["Order 12-lead EKG.", "Refer to cardiologist.", "Order full lipid panel & troponin test.", "Schedule stress test."],
                    medium: ["Order full lipid panel.", "Recommend lifestyle changes (diet/exercise).", "Schedule 6-month follow-up."],
                    low: ["Continue annual wellness checks.", "Reinforce heart-healthy lifestyle."]
                },
                cancer: {
                    high: ["Refer to oncologist/specialist.", "Order relevant imaging (e.g., Low-Dose CT for smoker, Mammogram).", "Order relevant blood work (e.g., CEA, PSA)."],
                    medium: ["Develop a personalized screening plan.", "Strongly advise smoking cessation.", "Discuss genetic counseling if family history is strong."],
                    low: ["Follow standard age-appropriate screening guidelines (e.g., colonoscopy, mammogram)."]
                }
            };

            // --- Define weights for each feature to improve "accuracy" ---
            const modelWeights = {
                diabetes: {
                    Age: 0.3,           // Less important
                    BMI: 0.8,           // Very important
                    Glucose: 1.0,       // Most important
                    SystolicBP: 0.2,    // Least important
                    FamilyHistory: 0.7, // Very important
                },
                heart: {
                    age: 0.5,
                    sex: 0.3,
                    cp: 1.0,            // Very important
                    trestbps: 0.6,
                    chol: 0.6,
                    fbs: 0.2,
                    thalach: -0.7,      // Inverted: Lower is worse
                    exang: 0.8,         // Very important
                    hasEKG: 0.4,        // Multimodal EKG weight
                },
                cancer: {
                    Age: 1.0,           // Most important
                    BMI: 0.6,
                    Smoker: 0.9,        // Very important
                    FamilyHistory: 0.9, // Very important
                    hasImage: 0.7,      // Multimodal Image weight
                }
            };

            // --- Mobile Menu Toggle ---
            const menuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            menuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                menuBtn.innerHTML = mobileMenu.classList.contains('hidden') 
                    ? '<i class="ph ph-list text-3xl"></i>' 
                    : '<i class="ph ph-x text-3xl"></i>';
            });
            
            // --- Form & Results Elements ---
            const formError = document.getElementById('form-error');
            const resultsPanel = document.getElementById('results-panel');
            const loader = document.getElementById('loader');
            const initialState = document.getElementById('initial-state');
            const resultsState = document.getElementById('results-state');
            
            // --- Tab & Form Elements ---
            const tabButtons = {
                diabetes: document.getElementById('tab-btn-diabetes'),
                heart: document.getElementById('tab-btn-heart'),
                cancer: document.getElementById('tab-btn-cancer'),
            };
            const forms = {
                diabetes: document.getElementById('diabetes-form'),
                heart: document.getElementById('heart-form'),
                cancer: document.getElementById('cancer-form'),
            };

            // --- History Log Elements ---
            const historyTableBody = document.getElementById('history-table-body');
            const emptyRow = document.getElementById('empty-row');
            const patientCountEl = document.getElementById('patient-count');
            const clearHistoryBtn = document.getElementById('clear-history-btn');

            // --- 1. TAB SWITCHING LOGIC ---
            function switchTab(activeKey) {
                Object.keys(tabButtons).forEach(key => {
                    const btn = tabButtons[key];
                    const form = forms[key];
                    
                    if (key === activeKey) {
                        btn.classList.add('tab-btn-active');
                        btn.classList.remove('tab-btn-inactive');
                        form.classList.remove('hidden');
                    } else {
                        btn.classList.remove('tab-btn-active');
                        btn.classList.add('tab-btn-inactive');
                        form.classList.add('hidden');
                    }
                });
                // Reset results panel
                initialState.classList.remove('hidden');
                resultsState.classList.add('hidden');
                formError.textContent = '';
                document.getElementById('ekg-file-name').textContent = '';
                document.getElementById('scan-file-name').textContent = '';
            }

            tabButtons.diabetes.addEventListener('click', () => switchTab('diabetes'));
            tabButtons.heart.addEventListener('click', () => switchTab('heart'));
            tabButtons.cancer.addEventListener('click', () => switchTab('cancer'));

            
            // --- 2. SYNTHETIC DATA & MODEL "TRAINING" ---
            
            function getStats(array) {
                if (array.length === 0) return { mean: 0, std: 1 };
                const n = array.length;
                const mean = array.reduce((a, b) => a + b) / n;
                const std = Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n);
                return { mean, std: std || 1 }; // Avoid divide by zero
            }
            
            function trainHeuristicModel(data, features, diseaseLabel) {
                const atRiskPatients = data.filter(p => p[diseaseLabel] === 1);
                
                let model = {
                    prevalence: (atRiskPatients.length / data.length) || 0.01,
                    features: {}
                };
                
                features.forEach(feature => {
                    if(feature === 'hasImage' || feature === 'hasEKG') {
                        model.features[feature] = { mean: 0.3, std: 0.45 };
                    }
                    else if (atRiskPatients.length > 0) {
                        model.features[feature] = getStats(atRiskPatients.map(p => p[feature]));
                    } else {
                        const allStats = getStats(data.map(p => p[feature]));
                        allStats.mean *= 1.2; 
                        model.features[feature] = allStats;
                    }
                });
                return model;
            }

            function generateDiabetesData(num_samples = 5000) {
                const data = [];
                const randn = () => ((Math.random() + Math.random() + Math.random()) - 1.5) * 2;
                for (let i=0; i<num_samples; i++) {
                    const Age = 21 + Math.random() * 50;
                    const BMI = 18 + randn() * 12;
                    const FamilyHistory = Math.random() < 0.3 ? 1 : 0;
                    
                    const Glucose = 80 + randn() * 20 + (BMI - 22) * 1.5 + (Age - 21) * 0.5;
                    const SystolicBP = 100 + randn() * 15 + (BMI - 22) * 1.0 + (Age - 21) * 0.3;
                    
                    const Outcome = (Glucose > 126) || (BMI > 35 && Glucose > 110) || (Age > 50 && Glucose > 120) || (FamilyHistory > 0 && Glucose > 115);
                    data.push({ Age, BMI, Glucose, SystolicBP, FamilyHistory, Outcome: Outcome ? 1 : 0 });
                }
                return data;
            }

            function generateHeartData(num_samples = 5000) {
                const data = [];
                const randn = () => ((Math.random() + Math.random() + Math.random()) - 1.5) * 2;
                for (let i=0; i<num_samples; i++) {
                    const age = 30 + Math.random() * 45;
                    const sex = Math.random() < 0.7 ? 1 : 0; 
                    const cp = Math.floor(Math.random() * 4); 
                    
                    const chol = 150 + randn() * 50 + (age - 30) * 0.5;
                    const trestbps = 100 + randn() * 20 + (chol - 200) * 0.1 + (age-30) * 0.3;
                    const fbs = (chol > 200 && Math.random() < 0.3) ? 1 : 0;
                    const thalach = 180 - (age * 0.8);
                    const exang = (cp > 0 && Math.random() < 0.4) ? 1 : 0;
                    
                    const hasEKG = (exang === 1 && Math.random() < 0.5) ? 1 : 0; 
                    
                    const output = (cp > 0) || (thalach < 140 && age > 50) || (exang === 1) || (chol > 240 && trestbps > 140) || (hasEKG === 1);
                    data.push({ age, sex, cp, trestbps, chol, fbs, thalach, exang, hasEKG, output: output ? 1 : 0 });
                }
                return data;
            }

            function generateCancerData(num_samples = 5000) {
                const data = [];
                const randn = () => ((Math.random() + Math.random() + Math.random()) - 1.5) * 2;
                for (let i=0; i<num_samples; i++) {
                    const Age = 21 + Math.random() * 50;
                    const BMI = 18 + randn() * 12;
                    const Smoker = Math.random() < 0.3 ? 1 : 0;
                    const FamilyHistory = Math.random() < 0.2 ? 1 : 0;
                    
                    const hasImage = (Age > 60 && Smoker > 0 && Math.random() < 0.4) ? 1 : 0; 
                    
                    const diagnosis = (Age > 60 && Smoker > 0) || (Age > 50 && FamilyHistory > 0) || (BMI > 35 && Age > 55) || (hasImage === 1);
                    data.push({ Age, BMI, Smoker, FamilyHistory, hasImage, diagnosis: diagnosis ? 1 : 0 });
                }
                return data;
            }
            
            // --- 3. PREDICTION & REPORTING ---
            
            function interpretRisk(prob) {
                if (prob < 0.33) return { level: "low", color: "green" };
                if (prob < 0.66) return { level: "medium", color: "amber" };
                return { level: "high", color: "red" };
            }
            
            function getDiseaseInsight(diseaseKey) {
                const insights = {
                    "diabetes": "Diabetes risk is strongly linked to glucose levels, BMI, and age. Early detection is key.",
                    "heart": "Heart disease risk is impacted by cholesterol, blood pressure, and chest pain (angina) patterns.",
                    "cancer": "General cancer risk is strongly linked to age, family history, smoking, and high BMI."
                };
                return insights[diseaseKey] || "";
            }

            function getZScore(value, modelStats) {
                 return (value - modelStats.mean) / modelStats.std;
            }

            function getRiskAssessment(patientData, diseaseKey) {
                const model = trainedModels[diseaseKey];
                if (!model) return { error: "Model not trained." };
                
                const weights = modelWeights[diseaseKey];
                
                let score = Math.log(model.prevalence / (1 - model.prevalence)); 
                let xai_drivers = [];
                let weighted_z_scores = [];

                for (const feature in patientData) {
                    const stats = model.features[feature];
                    const weight = weights[feature];
                    
                    if (stats && weight) {
                        const z = getZScore(patientData[feature], stats);
                        let weighted_z;
                        
                        if (weight < 0) {
                            weighted_z = z * weight;
                        } else {
                            weighted_z = z * weight;
                        }
                        
                        if (weighted_z > 0) {
                            score += weighted_z; 
                        }
                        
                        weighted_z_scores.push({ 
                            feature, 
                            z, 
                            value: patientData[feature], 
                            weighted_z 
                        });
                    }
                }
                
                weighted_z_scores.sort((a, b) => b.weighted_z - a.weighted_z); 
                
                for(let i=0; i<Math.min(3, weighted_z_scores.length); i++) {
                    const item = weighted_z_scores[i];
                    if (item.feature === 'hasImage' && item.value === 1) {
                        xai_drivers.push("<strong>Image Scan (Multimodal)</strong> detected high-risk indicators.");
                    } else if (item.feature === 'hasEKG' && item.value === 1) {
                        xai_drivers.push("<strong>Wearable EKG (Multimodal)</strong> detected potential arrhythmia.");
                    } else if (item.weighted_z > 0.2) { 
                         xai_drivers.push(`<strong>${item.feature}</strong> (${item.value}) is a primary risk factor.`);
                    }
                }
                
                if (xai_drivers.length === 0) {
                     xai_drivers.push("Patient vitals appear within the normal range for this model.");
                }

                const probability = 1 / (1 + Math.exp(-score)); // Sigmoid
                const xai = "<strong>Primary Drivers:</strong> " + xai_drivers.join(" ");

                return { prob: Math.max(0.01, Math.min(0.99, probability)), xai };
            }

            // --- 4. FORM SUBMISSION LISTENERS ---
            
            function handleFormSubmit(e, diseaseKey) {
                e.preventDefault();
                formError.textContent = '';
                
                const patientData = {};
                let patientName = '';
                let patientAge = 0;
                let historyInputs = {}; 
                
                try {
                    if (diseaseKey === 'diabetes') {
                        patientName = forms.diabetes.querySelector('#name-d').value;
                        if (!patientName) throw new Error('Patient Name is required.');
                        
                        const height = parseFloat(forms.diabetes.querySelector('#height-d').value);
                        const weight = parseFloat(forms.diabetes.querySelector('#weight-d').value);
                        if (!height || !weight || height <= 0 || weight <= 0) throw new Error('Invalid height or weight.');
                        const bmi = parseFloat((weight / ((height/100) * (height/100))).toFixed(1));
                        
                        patientAge = parseFloat(forms.diabetes.querySelector('#age-d').value);
                        patientData['Age'] = patientAge;
                        patientData['BMI'] = bmi;
                        patientData['Glucose'] = parseFloat(forms.diabetes.querySelector('#glucose').value);
                        patientData['SystolicBP'] = parseFloat(forms.diabetes.querySelector('#bp-d').value);
                        patientData['FamilyHistory'] = forms.diabetes.querySelector('#history-d').checked ? 1 : 0;
                        
                        historyInputs = { Glucose: patientData.Glucose, BMI: patientData.BMI, BP: patientData.SystolicBP };

                    } else if (diseaseKey === 'cancer') {
                        patientName = forms.cancer.querySelector('#name-c').value;
                        if (!patientName) throw new Error('Patient Name is required.');

                        const height = parseFloat(forms.cancer.querySelector('#height-c').value);
                        const weight = parseFloat(forms.cancer.querySelector('#weight-c').value);
                        if (!height || !weight || height <= 0 || weight <= 0) throw new Error('Invalid height or weight.');
                        const bmi = parseFloat((weight / ((height/100) * (height/100))).toFixed(1));

                        patientAge = parseFloat(forms.cancer.querySelector('#age-c').value);
                        patientData['Age'] = patientAge;
                        patientData['BMI'] = bmi;
                        patientData['Smoker'] = forms.cancer.querySelector('#smoker-c').checked ? 1 : 0;
                        patientData['FamilyHistory'] = forms.cancer.querySelector('#history-c').checked ? 1 : 0;
                        
                        patientData['hasImage'] = document.getElementById('scan-file-name').textContent ? 1 : 0;
                        
                        historyInputs = { BMI: patientData.BMI, Smoker: patientData.Smoker ? 'Yes' : 'No' };
                        if(patientData['hasImage']) historyInputs['Scan'] = 'Uploaded';


                    } else if (diseaseKey === 'heart') {
                        patientName = forms.heart.querySelector('#name-h').value;
                        if (!patientName) throw new Error('Patient Name is required.');

                        const features = Object.keys(trainedModels[diseaseKey].features);
                         features.forEach(feature => {
                            if(feature === 'hasEKG') return; 
                            
                            const inputEl = e.target.querySelector(`[id^="${feature}"]`);
                            if (!inputEl) throw new Error(`Missing input for ${feature}`);
                            const val = parseFloat(inputEl.value);
                            if (isNaN(val)) throw new Error(`Invalid input for ${feature}`);
                            patientData[feature] = val;
                        });
                        patientAge = patientData.age;
                        
                        patientData['hasEKG'] = document.getElementById('ekg-file-name').textContent ? 1 : 0;

                        historyInputs = { CP: patientData.cp, Chol: patientData.chol, ExAng: patientData.exang ? 'Yes' : 'No' };
                        if(patientData['hasEKG']) historyInputs['EKG'] = 'Uploaded';
                    }
                    
                    for (const key in patientData) {
                        if (isNaN(patientData[key])) throw new Error(`Invalid value for ${key}.`);
                    }

                } catch (err) {
                    formError.textContent = err.message;
                    return;
                }
                
                loader.classList.remove('hidden');
                loader.classList.add('flex');
                initialState.classList.add('hidden');
                resultsState.classList.add('hidden');
                
                setTimeout(() => {
                    const results = getRiskAssessment(patientData, diseaseKey);
                    
                    if (results.error) {
                        formError.textContent = results.error;
                        loader.classList.add('hidden');
                        loader.classList.remove('flex');
                        initialState.classList.remove('hidden');
                        return;
                    }
                    
                    displayResults(results, diseaseKey, patientName);
                    
                    const historyRecord = {
                        id: crypto.randomUUID(),
                        name: patientName,
                        age: patientAge,
                        assessmentType: diseaseKey.charAt(0).toUpperCase() + diseaseKey.slice(1),
                        riskScore: results.prob,
                        inputs: historyInputs
                    };
                    patientHistory.push(historyRecord);
                    saveHistory();
                    renderHistory();

                    loader.classList.add('hidden');
                    loader.classList.remove('flex');
                    resultsState.classList.remove('hidden');
                    
                    document.getElementById('ekg-file-name').textContent = '';
                    document.getElementById('scan-file-name').textContent = '';

                }, 1500); 
            }
            
            forms.diabetes.addEventListener('submit', (e) => handleFormSubmit(e, 'diabetes'));
            forms.heart.addEventListener('submit', (e) => handleFormSubmit(e, 'heart'));
            forms.cancer.addEventListener('submit', (e) => handleFormSubmit(e, 'cancer'));

            // --- 5. DISPLAY RESULTS ---
            function displayResults(results, diseaseKey, patientName) {
                const { prob, xai } = results;
                const { level, color } = interpretRisk(prob);
                const title = diseaseKey.charAt(0).toUpperCase() + diseaseKey.slice(1);
                
                document.getElementById('result-title').textContent = `${title} Risk Report`;
                document.getElementById('result-patient-name').textContent = `Patient: ${patientName}`;
                
                document.getElementById('risk-value').textContent = `${(prob * 100).toFixed(0)}% (${level.charAt(0).toUpperCase() + level.slice(1)})`;
                document.getElementById('risk-value').className = `text-2xl font-bold text-${color}-600`;
                
                document.getElementById('risk-bar').style.width = `${prob * 100}%`;
                document.getElementById('risk-bar').className = `bg-${color}-500 h-2.5 rounded-full`;
                
                document.getElementById('risk-insight').textContent = getDiseaseInsight(diseaseKey);
                
                // --- Update Precaution Banner ---
                const precautionText = PRECAUTIONS[diseaseKey][level];
                const precautionContainer = document.getElementById('precaution-container');
                document.getElementById('precaution-text').textContent = precautionText;
                precautionContainer.className = `precaution-banner precaution-banner-${level}`;
                
                // --- NEW: Update Next Steps ---
                const nextSteps = NEXT_STEPS[diseaseKey][level];
                const nextStepsList = document.getElementById('next-steps-list');
                nextStepsList.innerHTML = ''; // Clear previous steps
                nextSteps.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    nextStepsList.appendChild(li);
                });
                
                document.getElementById('xai-finding').innerHTML = xai;
            }


            // --- 6. LOCAL STORAGE & HISTORY MANAGEMENT ---
            function saveHistory() {
                localStorage.setItem('patientHistoryLog-v3', JSON.stringify(patientHistory));
            }

            function loadHistory() {
                const storedHistory = localStorage.getItem('patientHistoryLog-v3');
                if (storedHistory) {
                    patientHistory = JSON.parse(storedHistory);
                } else {
                    patientHistory = [];
                }
            }

            function renderHistory() {
                historyTableBody.innerHTML = '';

                if (patientHistory.length === 0) {
                    historyTableBody.appendChild(emptyRow);
                    patientCountEl.textContent = '0';
                    return;
                }

                patientCountEl.textContent = patientHistory.length;
                
                patientHistory.slice().reverse().forEach(patient => {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-slate-100 hover:bg-slate-50';
                    
                    const { level, color } = interpretRisk(patient.riskScore);
                    const inputsText = Object.entries(patient.inputs)
                        .map(([key, value]) => `${key}: <strong>${value}</strong>`)
                        .join(', ');

                    tr.innerHTML = `
                        <td class="p-4">
                            <div class="font-medium text-slate-900">${patient.name}</div>
                            <div class="text-xs text-slate-500">${patient.id.split('-')[0]}</div>
                        </td>
                        <td class="p-4 text-slate-700 text-sm">
                            <strong>${patient.age}</strong>
                        </td>
                        <td class="p-4 text-slate-700 text-sm">
                            <strong>${patient.assessmentType}</strong>
                        </td>
                         <td class="p-4 text-${color}-600 text-sm font-semibold">
                            ${(patient.riskScore * 100).toFixed(0)}% (${level.charAt(0).toUpperCase() + level.slice(1)})
                        </td>
                        <td class="p-4 text-slate-700 text-xs">
                           ${inputsText}
                        </td>
                    `;
                    historyTableBody.appendChild(tr);
                });
            }

            clearHistoryBtn.addEventListener('click', () => {
                console.log("Clear history clicked.");
                patientHistory = [];
                saveHistory();
                renderHistory();
            });

            // --- 7. DRAG & DROP LOGIC ---
            function setupDropZone(dropZoneId, fileNameId) {
                const dropZone = document.getElementById(dropZoneId);
                const fileNameEl = document.getElementById(fileNameId);

                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('drop-zone-over');
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('drop-zone-over');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drop-zone-over');
                    
                    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                        const fileName = e.dataTransfer.files[0].name;
                        fileNameEl.textContent = `✓ Uploaded: ${fileName}`;
                        e.dataTransfer.clearData();
                    }
                });
            }

            // --- 8. INITIAL PAGE LOAD ---
            function initializeModels() {
                console.log("Training all simulation models on page load...");
                
                const diabetesFeatures = ['Age', 'BMI', 'Glucose', 'SystolicBP', 'FamilyHistory'];
                const diabetesData = generateDiabetesData();
                trainedModels.diabetes = trainHeuristicModel(diabetesData, diabetesFeatures, 'Outcome');
                console.log("NEW Diabetes model... ready.");
                
                const heartFeatures = ['age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'thalach', 'exang', 'hasEKG'];
                const heartData = generateHeartData();
                trainedModels.heart = trainHeuristicModel(heartData, heartFeatures, 'output');
                console.log("NEW Heart model... ready.");
                
                const cancerFeatures = ['Age', 'BMI', 'Smoker', 'FamilyHistory', 'hasImage'];
                const cancerData = generateCancerData();
                trainedModels.cancer = trainHeuristicModel(cancerData, cancerFeatures, 'diagnosis');
                console.log("NEW Cancer model... ready.");
                
                console.log("All models trained and ready.");
            }
            
            initializeModels();
            loadHistory();
            renderHistory();
            
            setupDropZone('ekg-drop-zone', 'ekg-file-name');
            setupDropZone('scan-drop-zone', 'scan-file-name');
        });
    </script>
</body>
</html>

